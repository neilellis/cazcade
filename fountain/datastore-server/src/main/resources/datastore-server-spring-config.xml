<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <import resource="classpath:datastore-spring-config.xml"/>
    <import resource="classpath:messaging-context.xml"/>

    <bean id="messageSender" class="cazcade.fountain.messaging.LiquidMessageSender"
          p:pubSub-ref="pubSub"/>

    <bean id="dataStoreRemoteRequestHandler" init-method="start" destroy-method="stop"
          class="cazcade.fountain.datastore.server.DataStoreServerMessageHandler">
        <property name="compensator" ref="compensator"/>
        <property name="messageSender" ref="messageSender"/>
        <property name="store" ref="localDataStore"/>
        <property name="pubSub" ref="pubSub"/>
    </bean>

    <bean id="fountainDataStoreRPCServer" class="cazcade.fountain.datastore.server.FountainDataStoreRPCServer"
          init-method="start" destroy-method="stop"
          p:topic="rpc-topic" p:pubSub-ref="pubSub" p:handler-ref="dataStoreRemoteRequestHandler"
          p:messageSender-ref="messageSender"/>
</beans>